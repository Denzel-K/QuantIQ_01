<section class="skeleton">
  {{>sidebar}}

  <section class="parent_container">
    {{>dynamic_head}}

    <div class="dynamic_body">
      {{!-- Your sections and divs go here --}}
      <section class = "collection_widget rounded-md">
        <div class="collections_header">
          <h2>My Collections</h2>

          <button id="open-customize-btn">
            <img src="assets/icons/create-collection.svg" alt="create-collection">
          </button>
        </div>

        <div class="default_colls">
          <div class="def_coll coll-1" data-table="Employees">
            <span>
              <img src="assets/icons/single-collection.svg" alt="single-collection" />
            </span>
            <span>
              Employees
            </span>                 
          </div>

          <div class="def_coll coll-2" data-table="Products">
            <span>
              <img src="assets/icons/single-collection.svg" alt="single-collection" />
            </span>
            <span>
              Orders
            </span> 
          </div>

          <div class="def_coll coll-3" data-table="Orders">
            <span>
              <img src="assets/icons/single-collection.svg" alt="single-collection" />
            </span>
            <span>
              Products
            </span> 
          </div>

          <div class="def_coll coll-4" data-table="Inventory">
            <span>
              <img src="assets/icons/single-collection.svg" alt="single-collection" />
            </span>
            <span>
              Inventory
            </span> 
          </div>

          <div class="def_coll coll-5" data-table="Sales">
            <span>
              <img src="assets/icons/single-collection.svg" alt="single-collection" />
            </span>
            <span>
              Sales
            </span>       
          </div>

          <div class="def_coll coll-6" data-table="Customers">
            <span>
              <img src="assets/icons/single-collection.svg" alt="single-collection" />
            </span>
            <span>
              Customers
            </span> 
          </div>
        </div>
      </section>

      <section class="collection_details">
        <div class="detail_head">
          <span id="collection_title">Sales</span>
          <button class="generate">
            Generate table
          </button>
        </div>

        <div class="detail_body">
          <div class="collection_schema hidden">
            {{!-- Show the schema of the current collection. --}}
          </div>

          <div class="data_processing hidden">
            {{!-- Display the different ways of inserting data into the specified collection --}}
            <div class="processing_opts">
              <span>Upload File</span>
              <span>Enter manually</span>
            </div>

            <div class="processing_method">
              
            </div>
          </div>

          <div class="space-y-6 w-full">
            <!-- Employees Table -->
            <div id="Employees" class="table-content bg-white p-4 shadow-md rounded-lg">
                <table class="min-w-full bg-white border rounded-lg">
                    <thead class="bg-gray-200">
                        <tr>
                            <th class="px-6 py-3 text-left">Employee</th>
                            <th class="px-6 py-3 text-left">Role</th>
                            <th class="px-6 py-3 text-left">Email</th>
                            <th class="px-6 py-3 text-left">Status</th>
                            <th class="px-6 py-3 text-left">Hire Date</th>
                        </tr>
                    </thead>
                    <tbody>
                        <tr class="border-b">
                            <td class="px-6 py-4 text-left flex flex-row gap-2"><img src="assets/passport1.jpeg" alt="" class="w-8 h-8 rounded-2xl"><p>Futterkiste</p> </td>
                            <td class="px-6 py-4">Sales Manager</td>
                            <td class="px-6 py-4">Futterkiste@example.com</td>
                            <td class="px-6 py-4 text-green-600"><span class="px-2 py-1 text-xs font-semibold text-green-600 bg-green-100 rounded-md">Active</span></td>
                            <td class="px-6 py-4">2022-03-15</td>
                        </tr>
                        <tr class="border-b">
                            <td class="px-6 py-4 text-left flex flex-row gap-2"><img src="assets/passport2.jpeg" alt="" class="w-8 h-8 rounded-2xl"><p>Bob Smith</p></td>
                            <td class="px-6 py-4">Warehouse Supervisor</td>
                            <td class="px-6 py-4">bob@example.com</td>
                            <td class="px-6 py-4 text-red-600"><span class="px-2 py-1 text-xs font-semibold text-red-600 bg-red-100 rounded-md">Inactive</span></td>
                            <td class="px-6 py-4">2020-07-10</td>
                        </tr>
                        <tr class="border-b">
                            <td class="px-6 py-4 text-left flex flex-row gap-2"><img src="assets/passport3.jpeg" alt="" class="w-8 h-8 rounded-2xl"><p>Clara Adams</p></td>
                            <td class="px-6 py-4">Marketing Executive</td>
                            <td class="px-6 py-4">clara@example.com</td>
                            <td class="px-6 py-4 text-green-600"><span class="px-2 py-1 text-xs font-semibold text-green-600 bg-green-100 rounded-md">active</span></td>
                            <td class="px-6 py-4">2023-01-08</td>
                        </tr>
                    </tbody>
                </table>
            </div>

            <!-- Products Table -->
            <div id="Products" class="table-content hidden bg-white p-4 shadow-md rounded-lg">
                <table class="min-w-full bg-white border rounded-lg">
                    <thead class="bg-gray-200">
                        <tr>
                            <th class="px-6 py-3 text-left">Product</th>
                            <th class="px-6 py-3 text-left">Category</th>
                            <th class="px-6 py-3 text-left">Stock</th>
                            <th class="px-6 py-3 text-left">Supplier</th>
                        </tr>
                    </thead>
                    <tbody>
                        <tr class="border-b">
                            <td class="px-6 py-4">Wireless Mouse</td>
                            <td class="px-6 py-4">Electronics</td>
                            <td class="px-6 py-4">150</td>
                            <td class="px-6 py-4">TechSupply Co.</td>
                        </tr>
                        <tr class="border-b">
                            <td class="px-6 py-4">Office Chair</td>
                            <td class="px-6 py-4">Furniture</td>
                            <td class="px-6 py-4">30</td>
                            <td class="px-6 py-4">FurniWorld</td>
                        </tr>
                    </tbody>
                </table>
            </div>

            <!-- Orders Table -->
            <div id="Orders" class="table-content hidden bg-white p-4 shadow-md rounded-lg">
                <table class="min-w-full bg-white border rounded-lg">
                    <thead class="bg-gray-200">
                        <tr>
                            <th class="px-6 py-3 text-left">Order ID</th>
                            <th class="px-6 py-3 text-left">Customer</th>
                            <th class="px-6 py-3 text-left">Date</th>
                            <th class="px-6 py-3 text-left">Status</th>
                        </tr>
                    </thead>
                    <tbody>
                        <tr class="border-b">
                            <td class="px-6 py-4">#ORD-2024-001</td>
                            <td class="px-6 py-4">John Doe</td>
                            <td class="px-6 py-4">2024-08-25</td>
                            <td class="px-6 py-4 text-green-600"><span class="px-2 py-1 text-xs font-semibold text-green-600 bg-green-100 rounded-md">Completed</span></td>
                        </tr>
                        <tr class="border-b">
                            <td class="px-6 py-4">#OPX-2024-021</td>
                            <td class="px-6 py-4">Frank Lampard</td>
                            <td class="px-6 py-4">2024-08-26</td>
                            <td class="px-6 py-4 text-green-600"><span class="px-2 py-1 text-xs font-semibold text-yellow-600 bg-yellow-100 rounded-md">Pending</span></td>
                        </tr>
                    </tbody>
                </table>
            </div>

            <!-- Inventory Table -->
            <div id="Inventory" class="table-content hidden bg-white p-4 shadow-md rounded-lg">
                <table class="min-w-full bg-white border rounded-lg">
                    <thead class="bg-gray-200">
                        <tr>
                            <th class="px-6 py-3 text-left">Item ID</th>
                            <th class="px-6 py-3 text-left">Product Name</th>
                            <th class="px-6 py-3 text-left">Category</th>
                            <th class="px-6 py-3 text-left">Stock Quantity</th>
                            <th class="px-6 py-3 text-left">Price per Unit</th>
                            <th class="px-6 py-3 text-left">Supplier</th>
                            <th class="px-6 py-3 text-left">Last Restock</th>
                        </tr>
                    </thead>
                    <tbody>
                        <tr class="border-b">
                            <td class="px-6 py-4">#I-101</td>
                            <td class="px-6 py-4">Laptop</td>
                            <td class="px-6 py-4">Electronics</td>
                            <td class="px-6 py-4">15</td>
                            <td class="px-6 py-4">$899</td>
                            <td class="px-6 py-4">TechWorld Ltd.</td>
                            <td class="px-6 py-4">2024-08-20</td>
                        </tr>
                        <tr class="border-b">
                            <td class="px-6 py-4">#I-102</td>
                            <td class="px-6 py-4">Wireless Mouse</td>
                            <td class="px-6 py-4">Accessories</td>
                            <td class="px-6 py-4">50</td>
                            <td class="px-6 py-4">$25</td>
                            <td class="px-6 py-4">Gadgets Hub</td>
                            <td class="px-6 py-4">2024-08-22</td>
                        </tr>
                        <tr class="border-b">
                            <td class="px-6 py-4">#I-103</td>
                            <td class="px-6 py-4">Office Chair</td>
                            <td class="px-6 py-4">Furniture</td>
                            <td class="px-6 py-4">10</td>
                            <td class="px-6 py-4">$150</td>
                            <td class="px-6 py-4">Comfort Seating</td>
                            <td class="px-6 py-4">2024-08-18</td>
                        </tr>
                        <tr class="border-b">
                            <td class="px-6 py-4">#I-104</td>
                            <td class="px-6 py-4">Monitor 24''</td>
                            <td class="px-6 py-4">Electronics</td>
                            <td class="px-6 py-4">25</td>
                            <td class="px-6 py-4">$199</td>
                            <td class="px-6 py-4">VisionTech</td>
                            <td class="px-6 py-4">2024-08-21</td>
                        </tr>
                        <tr class="border-b">
                            <td class="px-6 py-4">#I-105</td>
                            <td class="px-6 py-4">Mechanical Keyboard</td>
                            <td class="px-6 py-4">Accessories</td>
                            <td class="px-6 py-4">30</td>
                            <td class="px-6 py-4">$75</td>
                            <td class="px-6 py-4">KeyTech Ltd.</td>
                            <td class="px-6 py-4">2024-08-19</td>
                        </tr>
                    </tbody>
                </table>
            </div>

            <!-- Sales Table -->
            <div id="Sales" class="table-content hidden bg-white p-4 shadow-md rounded-lg">
                <table class="min-w-full bg-white border rounded-lg">
                    <thead class="bg-gray-200">
                        <tr>
                            <th class="px-6 py-3 text-left">Sale ID</th>
                            <th class="px-6 py-3 text-left">Product</th>
                            <th class="px-6 py-3 text-left">Quantity</th>
                            <th class="px-6 py-3 text-left">Price per Unit</th>
                            <th class="px-6 py-3 text-left">Total</th>
                            <th class="px-6 py-3 text-left">Date</th>
                        </tr>
                    </thead>
                    <tbody>
                        <tr class="border-b">
                            <td class="px-6 py-4">#S-001</td>
                            <td class="px-6 py-4">Laptop</td>
                            <td class="px-6 py-4">2</td>
                            <td class="px-6 py-4">$899</td>
                            <td class="px-6 py-4 font-semibold">$1,798</td>
                            <td class="px-6 py-4">2024-08-25</td>
                        </tr>
                        <tr class="border-b">
                            <td class="px-6 py-4">#S-002</td>
                            <td class="px-6 py-4">Wireless Mouse</td>
                            <td class="px-6 py-4">5</td>
                            <td class="px-6 py-4">$25</td>
                            <td class="px-6 py-4 font-semibold">$125</td>
                            <td class="px-6 py-4">2024-08-26</td>
                        </tr>
                        <tr class="border-b">
                            <td class="px-6 py-4">#S-003</td>
                            <td class="px-6 py-4">Office Chair</td>
                            <td class="px-6 py-4">1</td>
                            <td class="px-6 py-4">$150</td>
                            <td class="px-6 py-4 font-semibold">$150</td>
                            <td class="px-6 py-4">2024-08-27</td>
                        </tr>
                        <tr class="border-b">
                            <td class="px-6 py-4">#S-004</td>
                            <td class="px-6 py-4">Monitor 24''</td>
                            <td class="px-6 py-4">3</td>
                            <td class="px-6 py-4">$199</td>
                            <td class="px-6 py-4 font-semibold">$597</td>
                            <td class="px-6 py-4">2024-08-28</td>
                        </tr>
                        <tr class="border-b">
                            <td class="px-6 py-4">#S-005</td>
                            <td class="px-6 py-4">Mechanical Keyboard</td>
                            <td class="px-6 py-4">4</td>
                            <td class="px-6 py-4">$75</td>
                            <td class="px-6 py-4 font-semibold">$300</td>
                            <td class="px-6 py-4">2024-08-29</td>
                        </tr>
                    </tbody>
                </table>
            </div>   

            <!-- Customers Table -->
            <div id="Customers" class="table-content hidden bg-white p-4 shadow-md rounded-lg">
              <table class="min-w-full bg-white border rounded-lg">
                  <thead class="bg-gray-200">
                      <tr>
                          <th class="px-6 py-3 text-left">Customer ID</th>
                          <th class="px-6 py-3 text-left">Full Name</th>
                          <th class="px-6 py-3 text-left">Email</th>
                          <th class="px-6 py-3 text-left">Phone Number</th>
                          <th class="px-6 py-3 text-left">Address</th>
                          <th class="px-6 py-3 text-left">City</th>
                          <th class="px-6 py-3 text-left">Join Date</th>
                      </tr>
                  </thead>
                  <tbody>
                      <tr class="border-b">
                          <td class="px-6 py-4">CUST-001</td>
                          <td class="px-6 py-4">John Doe</td>
                          <td class="px-6 py-4">john.doe@example.com</td>
                          <td class="px-6 py-4">+1 555-1234</td>
                          <td class="px-6 py-4">123 Main St</td>
                          <td class="px-6 py-4">New York</td>
                          <td class="px-6 py-4">2024-08-15</td>
                      </tr>
                      <tr class="border-b">
                          <td class="px-6 py-4">CUST-002</td>
                          <td class="px-6 py-4">Jane Smith</td>
                          <td class="px-6 py-4">jane.smith@example.com</td>
                          <td class="px-6 py-4">+1 555-5678</td>
                          <td class="px-6 py-4">456 Oak St</td>
                          <td class="px-6 py-4">Los Angeles</td>
                          <td class="px-6 py-4">2024-07-22</td>
                      </tr>
                      <tr class="border-b">
                          <td class="px-6 py-4">CUST-003</td>
                          <td class="px-6 py-4">Robert Johnson</td>
                          <td class="px-6 py-4">robert.j@example.com</td>
                          <td class="px-6 py-4">+1 555-8765</td>
                          <td class="px-6 py-4">789 Pine St</td>
                          <td class="px-6 py-4">Chicago</td>
                          <td class="px-6 py-4">2024-06-30</td>
                      </tr>
                      <tr class="border-b">
                          <td class="px-6 py-4">CUST-004</td>
                          <td class="px-6 py-4">Emily Davis</td>
                          <td class="px-6 py-4">emily.d@example.com</td>
                          <td class="px-6 py-4">+1 555-2345</td>
                          <td class="px-6 py-4">321 Maple Ave</td>
                          <td class="px-6 py-4">San Francisco</td>
                          <td class="px-6 py-4">2024-08-05</td>
                      </tr>
                      <tr class="border-b">
                          <td class="px-6 py-4">CUST-005</td>
                          <td class="px-6 py-4">Michael Brown</td>
                          <td class="px-6 py-4">michael.b@example.com</td>
                          <td class="px-6 py-4">+1 555-6789</td>
                          <td class="px-6 py-4">654 Cedar Rd</td>
                          <td class="px-6 py-4">Seattle</td>
                          <td class="px-6 py-4">2024-07-18</td>
                      </tr>
                  </tbody>
              </table>
            </div>
          </div>
        </div>
      </section>   
      <dialog class="custom-container">
        <div class="modal-header ">
          <h2>Create a Custom Collection</h2>
          <button class="close-btn" id="close-customize-btn">
            <img src="assets/icons/close-circle.svg" alt="close-circle">
          </button>
        </div>
        
        {{!-- <label for="collectionName">Collection Name:</label> --}}
        <input type="text" id="collectionName" placeholder="Enter collection name" class="coll_name">

        <section class="field_sect">
          <h3>Fields</h3>
          <div id="fieldsContainer">
            <div id="dynamic_fields">
              <!-- Dynamic Fields will be added here -->
            </div>

            <div id="fields_explained">
              <p>Add fields to define the structure of your collection. For example:</p>
              <ul>
                <li>Field Name: <strong>title</strong>, Type: <strong>String</strong></li>
                <li>Field Name: <strong>price</strong>, Type: <strong>Number</strong></li>
                <li>Field Name: <strong>isAvailable</strong>, Type: <strong>Boolean</strong></li>
              </ul>
            </div>
          </div>

          <button id="addFieldBtn">
            <img src="assets/icons/add_field.svg" alt="add_field">
            <span>Add Field</span>
          </button>
        </section>

        <button id="createCollectionBtn">Create Collection</button>

        <div id="responseMessage"></div>
      </dialog>
    </div>
  </section>
</section>

<script>
  document.addEventListener("DOMContentLoaded", function () {
    // Modal action
    const customizeModal = document.querySelector('.custom-container');
    const openCustomizer = document.querySelector('#open-customize-btn');
    const closeCustomizer = document.querySelector('#close-customize-btn');

    openCustomizer.addEventListener('click', () => {
      customizeModal.showModal();
    })
    closeCustomizer.addEventListener('click', () => {
      customizeModal.close();
    })

    const addFieldBtn = document.getElementById("addFieldBtn");
    const dynamicFields = document.getElementById("dynamic_fields");
    const fieldsExplained = document.getElementById("fields_explained");
    const createCollectionBtn = document.getElementById("createCollectionBtn");
    const responseMessage = document.getElementById("responseMessage");

    // Field options
    const fieldTypes = ["String", "Number", "Boolean", "Date", "Object"];

    // Function to toggle visibility of fields_explained and dynamic_fields
    function toggleFieldsVisibility() {
      if (dynamicFields.children.length === 0) {
        fieldsExplained.style.display = "block";
        dynamicFields.style.display = "none";
      } else {
        fieldsExplained.style.display = "none";
        dynamicFields.style.display = "block";
      }
    }

    // Initial visibility check
    toggleFieldsVisibility();

    // Add a new field dynamically
    addFieldBtn.addEventListener("click", function () {
      const fieldGroup = document.createElement("div");
      fieldGroup.classList.add("field-group");

      // Field name input
      const fieldName = document.createElement("input");
      fieldName.type = "text";
      fieldName.placeholder = "Field Name";
      fieldGroup.appendChild(fieldName);

      // Field type dropdown
      const fieldType = document.createElement("select");
      fieldTypes.forEach(type => {
        const option = document.createElement("option");
        option.value = type;
        option.textContent = type;
        fieldType.appendChild(option);
      });

      fieldGroup.appendChild(fieldType);

      // Remove button
      const removeBtn = document.createElement("button");
      removeBtn.textContent = "X";
      removeBtn.classList.add("remove-btn");
      removeBtn.addEventListener("click", function () {
        dynamicFields.removeChild(fieldGroup);
        toggleFieldsVisibility();
      });

      fieldGroup.appendChild(removeBtn);
      dynamicFields.appendChild(fieldGroup);

      // Update visibility
      toggleFieldsVisibility();
    });

    // Handle Create Collection
    createCollectionBtn.addEventListener("click", async function () {
      const collectionName = document.getElementById("collectionName").value.trim();
      if (!collectionName) {
        responseMessage.textContent = "Please enter a collection name.";
        return;
      }

      // Gather field data
      const fields = [];
      document.querySelectorAll(".field-group").forEach(group => {
        const name = group.querySelector("input").value.trim();
        const type = group.querySelector("select").value;
        if (name) fields.push({ name, type });
      });

      if (fields.length === 0) {
        responseMessage.textContent = "Please add at least one field.";
        return;
      }

      // Send data to backend
      try {
        const res = await fetch("/create-collection", {
          method: "POST",
          headers: { "Content-Type": "application/json" },
          body: JSON.stringify({ collectionName, fields }),
        });

        const data = await res.json();
        responseMessage.textContent = data.message || "Collection created successfully!";
      } 
      catch (error) {
        console.log(error);
        responseMessage.textContent = "Error creating collection!";
      }
    });
  });
</script>
<script>
  document.querySelectorAll('.def_coll').forEach(button => {
    button.addEventListener('click', function() {
        let targetTable = this.getAttribute('data-table');
        document.querySelector('#collection_title').textContent = targetTable;

        document.querySelectorAll('.table-content').forEach(table => {
          table.classList.add('hidden');
        });

        document.getElementById(targetTable).classList.remove('hidden');
    });
  });
</script>
<script src="js/shared.js"></script>